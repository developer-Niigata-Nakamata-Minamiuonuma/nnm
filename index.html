<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NNMInternet マイページ</title>
  <link rel="manifest" href="./manifest.json">
<meta name="theme-color" content="#bf0000">


<link href="https://fonts.googleapis.com/css2?family=M+PLUS+1:wght@600&display=swap" rel="stylesheet">

<style>
body {
  margin: 0;
  font-family: 'M PLUS 1', sans-serif;
  background: #f2f2f2;
}

/* ===== ヘッダー ===== */
.header {
  background: #bf0000;
  color: #fff;
  padding: 14px 16px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

/* ===== 重要なお知らせ ===== */
.notice {
  background: #fff4f4;
  border-bottom: 1px solid #ffd6d6;
  padding: 12px 16px;
  cursor: pointer;
}

.notice-title {
  color: #bf0000;
}

.notice-detail {
  margin-top: 8px;
  font-size: 13px;
  display: none;
}

/* ===== 共通 ===== */
.container {
  padding: 16px;
}

.card {
  background: #fff;
  border-radius: 12px;
  padding: 14px;
  margin-bottom: 16px;
  font-size: 14px;
}

.card-title {
  font-size: 13px;
  color: #666;
  margin-bottom: 10px;
}

.sub {
  font-size: 12px;
  color: #888;
}

/* ===== 利用料金 ===== */
.price {
  font-size: 28px;
  color: #bf0000;
}

/* ===== ボタン / リンク ===== */
.action-link,
.link-outline {
  display: block;
  text-align: center;
  text-decoration: none;
  padding: 12px;
  border-radius: 10px;
  font-size: 14px;
  margin-top: 10px;
}

.action-link {
  background: #bf0000;
  color: #fff;
}

.link-outline {
  border: 1px solid #bf0000;
  color: #bf0000;
  background: #fff;
}

/* ===== データ通信量 ===== */
.circle-wrap {
  position: relative;
  width: 220px;
  height: 220px;
  margin: 10px auto 0;
}

svg { transform: rotate(-90deg); }

.bg {
  fill: none;
  stroke: #eee;
  stroke-width: 16;
}

.progress {
  fill: none;
  stroke: #bf0000;
  stroke-width: 16;
  stroke-linecap: round;
  stroke-dasharray: 565;
}

.center-text {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 34px;
  color: #bf0000;
}

.label {
  text-align: center;
  font-size: 14px;
  color: #666;
  margin-top: 8px;
}

/* ===== メニュー（ドロワー） ===== */
.overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.4);
  display: none;
}

.drawer {
  position: fixed;
  top: 0;
  right: -280px;
  width: 280px;
  height: 100%;
  background: #fff;
  transition: right 0.3s;
}

.drawer.open { right: 0; }
.overlay.show { display: block; }

.drawer-header {
  background: #bf0000;
  color: #fff;
  padding: 14px 16px;
  display: flex;
  justify-content: space-between;
}

.drawer-body {
  padding: 16px;
}
</style>
</head>

<body>

<!-- ヘッダー -->
<div class="header">
  <div>NNMInternet マイページ</div>
  <div onclick="openMenu()">☰</div>
</div>

<!-- 重要なお知らせ -->
<div class="notice" onclick="toggleNotice()">
  <div class="notice-title">重要なお知らせ</div>
  <div class="notice-detail" id="noticeDetail">
    現在重要なお知らせは掲載されていません
  </div>
</div>

<div class="container">

  <!-- 利用料金 -->
  <div class="card">
    <div class="card-title">今月のご利用料金</div>
    <div class="price" id="db_fee">¥０</div>
    <div class="sub">5GHz帯 無制限</div>
  </div>

  <!-- Nメール -->
  <div class="card">
    <div class="card-title">Nメール</div>
    <div class="sub">
      独自ドメインのセキュアメールサービス
    </div>
    <a href="nmail.html" class="action-link">
      申込・詳細
    </a>
  </div>

  <!-- 通信情報 -->
  <div class="card">
    <div>提供通信：Open RAN</div>
    <div>通信方式：5GHz</div>
    <div>通信状態：＊＊</div>
  </div>

  <!-- データ通信量 -->
  <div class="card">
    <div class="card-title">
      データ通信量
    </div>

    <div class="circle-wrap">
      <svg width="220" height="220">
        <circle class="bg" cx="110" cy="110" r="90"/>
        <circle class="progress" cx="110" cy="110" r="90"/>
      </svg>
      <div class="center-text">無制限</div>
    </div>
  </div>

  <!-- 電波改善 -->
  <div class="card">
    <div class="card-title">電波改善のご要望</div>
    <a
      class="action-link"
      href="https://tayori.com/faq/d41902257c3dfd4f6c51189d13b3e6be00b13c51/detail/d660d53018622fb61182e3f0eb1ec61d69592c70/"
      target="_blank"
      rel="noopener"
    >
      電波改善フォームへ ↗
    </a>
  </div>

</div>

<!-- メニュー -->
<div class="overlay" onclick="closeMenu()"></div>

<div class="drawer">
  <div class="drawer-header">
    <div>メニュー</div>
    <div onclick="closeMenu()">✕</div>
  </div>

  <div class="drawer-body">
    <a href="mypage.html" class="link-outline">
      マイページ
    </a>

    <a href="nmail.html" class="link-outline">
      Nメール
    </a>

    <!-- 後でURL指定 -->
    <a href="#" class="link-outline">
      お申し込み履歴
    </a>
  </div>
</div>

<script>
function toggleNotice() {
  const d = document.getElementById('noticeDetail');
  d.style.display = d.style.display === 'block' ? 'none' : 'block';
}

function changeMonth() {
  const s = document.getElementById('monthSelect');
  document.getElementById('usageLabel').textContent =
    `高速データ通信（${s.value}）`;
}

function openMenu() {
  document.querySelector('.drawer').classList.add('open');
  document.querySelector('.overlay').classList.add('show');
}

function closeMenu() {
  document.querySelector('.drawer').classList.remove('open');
  document.querySelector('.overlay').classList.remove('show');
}
</script>

<!-- ★追加：DB読み込み -->
<script src="./api.js"></script>
<script src="./auth.js"></script>
<script>
(async () => {
  const login = requireLoginOrRedirect();
  if (!login) return;

  try {
    const res = await apiMe(login.contractId, login.userId);
    if (!res.ok) {
      logout();
      return;
    }

    const u = res.user;

    const feeEl = document.getElementById("db_fee");
    if (feeEl) feeEl.textContent = `¥${u.fee}`;

  } catch (e) {}
})();
</script>

<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('./service-worker.js');
}
</script>

</body>
</html>
